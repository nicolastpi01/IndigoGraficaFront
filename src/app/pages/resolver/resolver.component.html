<nz-collapse  nzAccordion>
  <nz-collapse-panel *ngFor="let panel of panels" [nzHeader]="panel.name" [nzActive]="panel.active">
    <ng-template [ngIf]="panel.name === 'Datos' " [ngIfElse]="ifElse">
    <div nz-col class="gutter-row">
      <nz-tabset>
        <nz-tab *ngFor="let tab of tabs" [nzTitle]="titleTemplate">
          <ng-template #titleTemplate>
            <i nz-icon [nzType]="tab.icon"></i>
            {{ tab.title }}
          </ng-template>
          <ng-template [ngIf]="tab.name === 'Pedido' " [ngIfElse]="usuario">
            <div nz-row *ngIf="currentPedido" nzJustify="center" [nzGutter]="{ xs: 24, sm: 32, md: 48, lg: 64 }">
              <div nz-col >
                <p class="subTitle">Título :</p>
                <p>{{currentPedido.nombre ? currentPedido.nombre : '-' }}</p>
              </div>
              <div nz-col >
                <p class="subTitle">SubTítulo :</p>
                <p>{{currentPedido.nombreExtendido ? currentPedido.nombreExtendido : '-' }}</p>
              </div>
              <div nz-col >
                <p class="subTitle">Tipo :</p>
                <p>{{ currentPedido.tipo && currentPedido.tipo.nombre ? currentPedido.tipo.nombre : '-'}}</p>
              </div>
              <div nz-col >
                <p class="subTitle">Fecha Entrega :</p>
                <p>{{ currentPedido.fechaEntrega ? toLocalDateStringFunction(currentPedido.fechaEntrega) : '-'}}</p>
              </div>
              <div nz-col >
                <p class="subTitle">Alto (px) :</p>
                <p>{{ currentPedido.alto ? currentPedido.alto : (currentPedido.tipo  ? currentPedido.tipo.alto : "-") }}</p>
              </div>
              <div nz-col >
                <p class="subTitle">Ancho (px) :</p>
                <p>{{ currentPedido.ancho ? currentPedido.ancho : (currentPedido.tipo  ? currentPedido.tipo.ancho : "-") }}</p>
              </div>
              <div nz-col >
                <p class="subTitle">Cantidad :</p>
                <p>{{ currentPedido.cantidad }}</p>
              </div>
              <div nz-col >
                <p class="subTitle">Tipografía :</p>
                <p>{{ currentPedido.tipografia ? currentPedido.tipografia : (currentPedido.tipo  ? currentPedido.tipo.tipografia : "-") }}</p>
              </div>
              <div nz-col >
                <p class="subTitle">Estado :</p>
                <ng-template [ngIf]="currentPedido.state" [ngIfElse]="WithoutState">
                  <p><nz-tag [nzColor]="colorear(currentPedido.state)">{{currentPedido.state}}</nz-tag></p>
                </ng-template>
                <ng-template #WithoutState>
                  <p>-</p>
                </ng-template>
              </div>
              <div nz-col >
                <p class="subTitle">Colores :</p>
                <ng-template 
                  [ngIf]="(currentPedido.colores && currentPedido.colores.length > 0) || (currentPedido.tipo && currentPedido.tipo.colores)" [ngIfElse]="WithoutColors">
                  <nz-list>
                    <nz-list-item style="display: inline; padding-left: 3px; padding-right: 3px; border-bottom: 0 none;" *ngFor="let color of pedidoColores()">
                      <nz-badge [nzColor]="color.hexCode">{{ color.nombre }}</nz-badge>
                    </nz-list-item>
                  </nz-list>
                </ng-template>
                <ng-template #WithoutColors>
                  <p>-</p>
                </ng-template>
              </div>
              <div nz-col >
                <p class="subTitle">Descripción :</p>
                <p>{{ currentPedido.descripcion ? currentPedido.descripcion : "-" }}</p>
              </div>
          </div>
          </ng-template>
          <ng-template #usuario>
            <div nz-row *ngIf="currentPedido && currentPedido.propietario" nzJustify="center" [nzGutter]="{ xs: 24, sm: 32, md: 48, lg: 64 }">
              <div nz-col >
                <p class="subTitle">Nombre :</p>
                <p>{{ currentPedido.propietario.nombre }}</p>
              </div>
              <div nz-col >
                <p class="subTitle">Apellido :</p>
                <p>{{ currentPedido.propietario.apellido }}</p>
              </div>
              <div nz-col >
                <p class="subTitle">Localidad :</p>
                <p>{{ currentPedido.propietario.ubicacion }}</p>
              </div>
              <div nz-col >
                <p class="subTitle">Nombre de Usuario :</p>
                <p>{{ currentPedido.propietario.username }}</p>
              </div>
              <div nz-col >
                <p class="subTitle">Correo :</p>
                <p>{{ currentPedido.propietario.email }}</p>
              </div>
              <div nz-col >
                <p class="subTitle">Contacto :</p>
                <p>{{ currentPedido.propietario.contacto }}</p>
              </div>
          </div>
          </ng-template>
        </nz-tab>
      </nz-tabset>
      
    </div>
    </ng-template>

     <ng-template #ifElse>
     <ng-template [ngIf]="panel.name === 'Comentarios' " [ngIfElse]="Resolver">
      <div nz-col class="gutter-row" [nzSpan]="16">
        <div>
            <nz-list nzGrid>
                <div nz-row [nzGutter]="16" *ngIf="currentPedido && currentPedido.files">
                  <div nz-col [nzSpan]="6" *ngFor="let file of currentPedido.files">
                    <nz-list-item>
                      <nz-card [nzCover]="coverTemplate" [nzActions]="[actionAddComment]">
                          <nz-card-meta
                              [nzTitle]="file.name"
                              nzDescription=""
                              [nzAvatar]="avatarTemplate"
                          ></nz-card-meta>
                            <ng-template #avatarTemplate>
                            </ng-template>
                            <ng-template #coverTemplate>
                              <img nz-image alt="no cargo imagen" *ngIf="file && file.url" [nzSrc]="file.url" [ngStyle]="{ width: '100%', height: '140px', cursor: 'pointer' }">
                            </ng-template>
                            <ng-template #actionAddComment>
                              <i nz-icon nzType="comment" (click)="onClickComment($event, file)" nzTheme="outline"></i>
                            </ng-template>
                      </nz-card>
                    </nz-list-item>
                  </div>
                </div>
            </nz-list>
        </div>
        <nz-modal
              [(nzVisible)]="isVisibleModalComment"
              [nzBodyStyle]="{ minHeight: '600px' }"
              nzWidth="100%"
              nzTitle="Responder"
              nzCentered
              (nzOnCancel)="handleCancelResolver()"
              (nzOnOk)="handleOkResolver()"
              nzOkText="Enviar marcados"
            >
              <ng-container *nzModalContent>
                  <div nz-row  [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" >
                    <div nz-col nzSpan="16" style="position: relative;" >
                      <img nz-image nzDisablePreview *ngIf="currentFile && currentFile.url" [nzSrc]="currentFile.url" [ngStyle]="{ maxWidth: '600px', minHeight: '400px'}">
                      <div *ngIf="currentFile && currentFile.comentarios">
                        <div *ngFor="let comentario of currentFile.comentarios">
                          <nz-badge
                            [nzCount]="comentario.numero"
                            [style]="badgeUponImagePositionStyle(comentario)">
                          </nz-badge>
                        </div>
                      </div>
                    </div>
                    <div nz-col nzSpan="8" >
                      <cdk-virtual-scroll-viewport itemSize="10" class="demo-infinite-container">
                      <nz-list *ngIf="currentFile && currentFile.comentarios">
                        <nz-list-item *cdkVirtualFor="let comentario of currentFile.comentarios">
                          <nz-comment [nzAuthor]="comentario.interacciones[0].rol" [nzDatetime]="now">
                            <nz-avatar
                              nz-comment-avatar
                              [textContent]="comentario.numero"
                              nzSize="large"
                              [style]="badgeColorStyleFunction()"
                            ></nz-avatar>
                            <nz-comment-content>
                            <p
                              nz-typography
                              nzEllipsis
                              nzExpandable
                              nzCopyable 
                              [nzCopyTooltips]="null"
                              [attr.title]="comentario.interacciones[0].texto"
                              [nzEllipsisRows]="1"
                              [nzContent]="comentario.interacciones[0].texto"
                            >
                            </p>
                            <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32, xl: 32, xxl: 32 } ">
                              <div nz-col>
                                <div nz-row [nzGutter]="8" (click)="onClickChat($event, comentario)" style="cursor: pointer;">
                                  <div nz-col>
                                      <!--strong>Ir al chat</strong-->
                                      <span nz-typography nzType="secondary">Ir al chat</span>
                                  </div>
                                  <div nz-col>
                                    <span nz-typography nzType="secondary"><i nz-icon nzType="message" nzTheme="outline"></i></span>
                                  </div>
                                </div>
                              </div>
                              <div nz-col>
                                <label nz-checkbox [(ngModel)]="comentario.terminado" (ngModelChange)="onChangeCheck($event, comentario)">
                                  <!--strong>{{ item.terminado ? 'Finalizado' : 'Marcar como finalizado' }}</strong-->
                                  <span nz-typography nzType="secondary">{{ comentario.terminado ? 'Finalizado' : 'Marcar como finalizado' }}</span>
                                </label>
                              </div>
                            </div>
                            </nz-comment-content>
                          </nz-comment> 
                        </nz-list-item>
                      </nz-list>
                      </cdk-virtual-scroll-viewport>
                    </div>
                  </div>
              </ng-container>
          </nz-modal> 
      </div>
            <!--nz-modal
              [(nzVisible)]="isVisibleModalChat"
              [nzBodyStyle]="{ minHeight: '600px' }"
              nzWidth="50%"
              nzTitle="Chat"
              nzCentered
              (nzOnCancel)="handleCancelChat()"
              (nzOnOk)="handleOkChat()"
            -->
            <nz-modal
              [(nzVisible)]="isVisibleModalChat"
              [nzBodyStyle]="{ minHeight: '600px' }"
              nzWidth="50%"
              nzTitle="Chat"
              nzCentered
              (nzOnCancel)="handleCancelModalResponse()"
              (nzOnOk)="handleOkModalResponse()"
              >
              <ng-container *nzModalContent>
                <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32, xl: 32, xxl: 32 } ">
                  <div nz-col nzSpan="8"> 
                    <!--cdk-virtual-scroll-viewport itemSize="10" class="demo-infinite-container"-->
                    <nz-list *ngIf="currentComment && currentComment.interacciones">
                      <nz-list-item *ngFor="let interaccion of currentComment.interacciones">
                        <nz-comment [nzAuthor]="interaccion.rol" [nzDatetime]="time">
                          <nz-avatar
                            nz-comment-avatar
                            [nzIcon]="determineIcon(interaccion)"
                            [style]="avatarStyle(interaccion)"
                          ></nz-avatar>
                          <nz-comment-content>
                          <p
                            nz-typography
                            nzEllipsis
                            nzExpandable
                            nzCopyable 
                            [nzCopyTooltips]="null"
                            [attr.title]="interaccion.texto"
                            [nzEllipsisRows]="2"
                            [nzContent]="interaccion.texto"
                          >
                          </p>
                          </nz-comment-content>
                          <nz-comment-action *ngIf="sePuedeResponder(interaccion)">
                              <a (click)="responderInteraccion($event, interaccion)">{{ interaccion.rol == 'USUARIO' ? 'Responder' : 'Editar respuesta'}}</a>
                          </nz-comment-action>
                        </nz-comment>                
                      </nz-list-item>
                    </nz-list>
                    <!--/cdk-virtual-scroll-viewport-->
                    </div>
                    <div nz-col nzSpan="14">
                    <nz-comment *ngIf="visibleResponse" nzAuthor="EDITOR" [nzDatetime]="time">
                      <nz-avatar nz-comment-avatar nzIcon="highlight" style="background-color: #f56a00"></nz-avatar>
                      <nz-comment-content>
                        <nz-form-item>
                            <textarea 
                              (ngModelChange)="onChangeTextArea($event)" 
                              [(ngModel)]="textAreaValue" nz-input rows="5">
                            </textarea>
                        </nz-form-item>
                        <form nz-form [nzLayout]="'inline'">
                          <nz-form-item>
                            <button nz-button nzType="default" [disabled]="isDisabledEliminarRespuesta()" (click)="eliminarRespuesta()">
                              Eliminar
                            </button>
                          </nz-form-item>
                        </form>
                      </nz-comment-content>
                    </nz-comment>
                  </div>
                </div>      
              </ng-container>
            </nz-modal>
            
            <!--nz-modal
              [(nzVisible)]="isVisibleModalResponse"
              [nzBodyStyle]="{ minHeight: '600px' }"
              nzWidth="50%"
              nzTitle="Respuesta"
              nzCentered
              (nzOnCancel)="handleCancelModalResponse()"
              (nzOnOk)="handleOkModalResponse()"
            >
              <ng-container *nzModalContent>         
                <nz-comment *ngIf="interaccionForResponse" [nzAuthor]="interaccionForResponse.rol">
                  <nz-avatar
                    nz-comment-avatar
                    [nzIcon]="determineIcon(interaccionForResponse)"
                    [style]="avatarStyle(interaccionForResponse)"
                  ></nz-avatar>
                  <nz-comment-content>
                    <p
                      nz-typography
                      nzEllipsis
                      nzExpandable
                      nzCopyable 
                      [nzCopyTooltips]="null"
                      [attr.title]="interaccionForResponse.texto"
                      [nzEllipsisRows]="2"
                      [nzContent]="interaccionForResponse.texto"
                    >
                    </p>
                  </nz-comment-content>
                </nz-comment>

              </ng-container>
            </nz-modal--> 
     </ng-template>
    </ng-template>

     <ng-template #Resolver>
      <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }">
        <ng-template [ngIf]="currentPedido && currentPedido.files && tieneDimension()" [ngIfElse]="ifElse">
          <div nz-col [nzSpan]="12">
            <p style="text-align: center;"><b>Archivos</b></p>
            <nz-list nzGrid>
              <div nz-row [nzGutter]="{ xs: 8, sm: 16, md: 24, lg: 32 }" *ngIf="currentPedido && currentPedido.files">
                <div nz-col nzXs="24" nzSm="8" *ngFor="let file of currentPedido.files">
                  <nz-list-item>
                    <!--nz-card [nzCover]="coverTemplate" [nzActions]="[actionAddComment, actionAddSolution]"-->
                    <nz-card [style]="cardStyle(file)" [nzCover]="coverTemplate" [nzActions]="[actionAddSolution]">
                      <nz-card-meta
                       [nzTitle]="file.name"
                        nzDescription=""
                      ></nz-card-meta>
                      <!--nz-card-meta
                       [nzTitle]="file.name"
                        nzDescription=""
                        [nzAvatar]="avatarTemplate"
                      ></nz-card-meta>
                        <ng-template #avatarTemplate>
                        </ng-template-->
                        <ng-template #coverTemplate>
                          <img nz-image alt="no cargo imagen" *ngIf="file && file.url" [nzSrc]="file.url" [ngStyle]="{ width: '100%', height: '140px', cursor: 'pointer' }">
                        </ng-template>
                        <!--ng-template #actionAddComment>
                          <i nz-icon nzType="comment" (click)="onClickComment($event, file)" nzTheme="outline"></i>
                        </ng-template-->
                        <ng-template #actionAddSolution>
                          <!--nz-upload [(nzFileList)]="fileList" [nzBeforeUpload]="beforeUpload"-->
                            <button nzType="default" nz-button (click)="onClickAddSolution($event, file)">
                              Solución
                              <!--span nz-icon  nzType="upload" (click)="onClickAddSolution($event, file)" nzTheme="outline"></span-->
                            </button>
                          <!--/nz-upload-->
                          <!--nz-upload
                            [nzAction]="handleAction"
                            nzListType="picture-card"
                            [(nzFileList)]="fileList"
                            [nzShowButton]="fileList.length < 8"
                            [nzPreview]="handlePreview"
                            (nzChange)="handleChange($event)"
                            *ngIf="currentPedido"
                          >
                            <div><i nz-icon nzType="upload" nzTheme="outline"></i></div>
                          </nz-upload-->
                          <!--i nz-icon nzType="upload" (click)="onClickAddSolution($event, file)" nzTheme="outline"></i-->
                        </ng-template>
                    </nz-card>
                  </nz-list-item>
                </div>
              </div>
            </nz-list>
          </div>
        </ng-template>
        <ng-template #ifElse>
          <!--button nz-button>
            <span nz-icon nzType="upload"></span>
            Upload
          </button MEJORAR EL UPLOAD -->
          
        </ng-template>
        
        <div nz-col nzXs="24" nzSm="12">
          <p *ngIf="currentSolution || showFallback || !tieneDimension()" style="text-align: center;"><b>Solución</b></p>
          <!--b>Solución</b-->
          <!--nz-card *ngIf="currentSolution" [nzCover]="coverTemplate" [nzActions]="[actionAddComment, actionAddSolution]"-->
          <!--nz-card [nzCover]="coverTemplate" [nzActions]="[actionAddComment, actionAddSolution]"-->
          <nz-card [nzCover]="coverTemplate" *ngIf="(currentSolution && currentSolution.url) || showFallback || !tieneDimension()" 
              [nzActions]="[actionDeleteSolution, actionAddSolution]">
            <nz-card-meta             
              nzDescription=""
              [nzAvatar]="avatarTemplate"
            ></nz-card-meta>
              <ng-template #avatarTemplate>
              </ng-template>
              <ng-template #coverTemplate>
                <ng-template [ngIf]="currentSolution && currentSolution.url" [ngIfElse]="Fallback">
                  <img nz-image [nzFallback]="fallback" alt="" [nzSrc]="currentSolution.url" width="800" height="400" >
                </ng-template>
                <ng-template #Fallback>
                  <img nz-image *ngIf="showFallback || !tieneDimension()" [nzFallback]="fallback" alt="" nzSrc="error" width="800" height="400" >
                </ng-template>  
              </ng-template>
              <ng-template #actionDeleteSolution>
                <button nz-button [disabled]="!currentSolution" (click)="onClickDeleteSolution($event)">
                  <span nz-icon nzType="delete" nzTheme="outline"></span>Eliminar
                </button>
              </ng-template>
              <ng-template #actionAddSolution>
                <nz-upload
                  nzAction="http://localhost:8080/files/upload"
                  (nzChange)="handleChange($event)"
                >
                  <button nz-button>
                    <span nz-icon nzType="upload" nzTheme="outline"></span>Subir
                  </button>
                </nz-upload>
              </ng-template>
            </nz-card>
        </div>
      </div>
      
     </ng-template>
  </nz-collapse-panel>
</nz-collapse>
<br>

<div nz-row class="buttonGroup" [nzGutter]="16">
  <div nz-col><button nz-button nzType="default" style="width: 120px;">Salir<i nz-icon nzType="home" nzTheme="outline"></i></button></div>
  <div nz-col><button nz-button nzType="primary">Resolver<i nz-icon nzType="check" nzTheme="outline"></i></button></div>
</div>



